// -------------------------------------------------------------------------- //
//         Sitecore Install Framework - XConnect Solr Configuration           //
//                                                                            //
//  Run this configuration on your Solr instance to configure the cores for   //
//  an XConnect deployment. If the cores exist, they will be overwritten.     //
//                                                                            //
//  NOTE: Only single line comments are accepted in configurations.           //
// -------------------------------------------------------------------------- //
{
    "Parameters": {
        // Parameters are values that may be passed when Install-SitecoreConfiguration is called.
        // Parameters must declare a Type and may declare a DefaultValue and Description.
        // Parameters with no DefaultValue are required when Install-SitecoreConfiguration is called.

        "SolrUrl": {
            "Type": "string",
            "DefaultValue": "https://localhost:8989/solr",
            "Description": "The Solr instance url."
        },
        "SolrRoot": {
            "Type": "string",
            "DefaultValue": "c:\\solr-6.6.2",
            "Description": "The file path to the Solr instance." 
        },
        "CorePrefix": {
            "Type": "string",
            "DefaultValue": "xp0",
            "Description": "The prefix for each of the created indexes."
        }
    },
  "Variables": {
    // Variables are values calculated in a configuration.
    // They can reference Parameters, other Variables, and config functions.

    // Resolves the full path to Solr on disk in case a relative path was passed.
    "Solr.FullRoot": "[resolvepath(parameter('SolrRoot'))]",
    "Solr.CorePath": "[joinpath(variable('Solr.FullRoot'), 'server', 'solr')]",

    // The name of the rebuild core to unload.
    "Xdb.Name": "[concat(parameter('CorePrefix'), '_xdb')]",
    "Xdb.Rebuild.Name": "[concat(variable('Xdb.Name'), '_rebuild')]",

    // The destination paths of the cores to create.
    "Core.Root": "[joinpath(variable('Solr.CorePath'), variable('Xdb.Name'))]",
    "Rebuild.Root": "[joinpath(variable('Solr.CorePath'), variable('Xdb.Rebuild.Name'))]"
  },
    "Tasks": {
        // Tasks are separate units of work in a configuration.
        // Each task is an action that will be completed when Install-SitecoreConfiguration is called.
        // By default, tasks are applied in the order they are declared.
        // Tasks may reference Parameters, Variables, and config functions. 
		"RemoveCore":{
			"Type": "RemoveFolder",
			"Params": [
				{ "Name": "[variable('Core.Root')]" },
				{ "Name": "[variable('Rebuild.Root')]"}
			]
		}
    },
	"Modules":[
		".\\Invoke-RemoveFolderTask.psm1"
	]
	
}